<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Open+Sans:wght@400;500;600;700&display=swap"
    rel="stylesheet" />

  <!-- Icon Fonts -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet" />

  <!-- TroyArticles Libraries -->
  <link href="/lib/animate/animate.min.css" rel="stylesheet" />
  <link href="/lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet" />

  <!-- TroyArticles Bootstrap Theme -->
  <link href="/css/bootstrap.min.css" rel="stylesheet" />

  <!-- TroyArticles Main Styles -->
  <link href="/css/style.css" rel="stylesheet" />
</head>

<body class="bg-light">

  <div class="container py-4">
    <h1 class="mb-4 text-center">Admin Panel</h1>

    <!-- Tabs -->
    <ul class="nav nav-tabs mb-4" id="adminTabs" role="tablist">
      <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#jobs">Jobs /
          Careers</button>
      </li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#jobs-applications">Jobs
          Applications</button>
      </li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="tab"
          data-bs-target="#publications">Publications</button></li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#team">Team</button></li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#contact">Contact</button></li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#partners">Partners</button>
      </li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="tab"
          data-bs-target="#membership-requests">Membership Requests</button>
      </li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#newsletter">Newsletter
          Subscribers</button>
      </li>
    </ul>

    <div class="tab-content">
      <div class="tab-pane fade show active" id="jobs">
        <form action="/admin/jobs" method="POST" class="bg-white p-4 rounded shadow-sm mb-4">
          <h3>Add Job</h3>

          <input class="form-control mb-2" name="title" placeholder="Title" required />

          <select class="form-control mb-2" name="category" required>
            <option value="">Select Category</option>
            <option value="technology_innovation">Technology & Innovation</option>
            <option value="business_finance">Business & Finance</option>
            <option value="research_strategy">Research & Strategy</option>
            <option value="legal_regulatory_affairs">Legal & Regulatory Affairs</option>
            <option value="marketing_communications">Marketing & Communications</option>
            <option value="operations_administration">Operations & Administration</option>
            <option value="social_impact_community_development">Social Impact & Community Development</option>
            <option value="internships_graduate_trainee_programs">Internships & Graduate Trainee Programs</option>
          </select>

          <textarea class="form-control mb-2" name="description" placeholder="Description" required></textarea>

          <input type="date" class="form-control mb-2" name="postedDate" required />
          <input type="date" class="form-control mb-2" name="deadline" />

          <button class="btn btn-primary">Add Job</button>
        </form>


        <h3>Existing Jobs</h3>
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Title</th>
              <th>Description</th>
              <th>Posted</th>
              <th>Deadline</th>
            </tr>
          </thead>
          <tbody>
            <% jobs.forEach(j=> { %>
              <tr>
                <td>
                  <%= j.title %>
                </td>
                <td>
                  <%= j.description %>
                </td>
                <td>
                  <%= j.postedDate %>
                </td>
                <td>
                  <%= j.deadline || '' %>
                </td>
                <td>
                  <form action="/jobs/delete/<%= j.id %>" method="post" class="d-inline"
                    onsubmit="return confirm('Are you sure you want to delete this job?');">
                    <button type="submit" class="btn btn-danger btn-sm">
                      <i class="fas fa-trash-alt"></i> Delete
                    </button>
                  </form>
                </td>
              </tr>
              <% }) %>
          </tbody>
        </table>
      </div>
      <div class="tab-pane fade" id="jobs-applications">
        <h3>Existing Jobs</h3>
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Applicant Name</th>
              <th>Email</th>
              <th>Cover Letter</th>
              <th>Applied At</th>
              <th>CV </th>
            </tr>
          </thead>
          <tbody>
            <% applications.forEach(j=> { %>
              <tr>
                <td>
                  <%= j.name %>
                </td>
                <td>
                  <%= j.email %>
                </td>
                <td>
                  <%= j.coverLetter %>
                </td>
                <td>
                  <%= j.appliedAt || '' %>
                </td>
                <td>
                  <% if (j.cv) { %>
                    <a href="/uploads/<%= j.cv %>" download>
                      <i class="fas fa-file-download"></i> Download CV
                    </a>
                    <% } else { %>
                      <span class="text-muted">No CV</span>
                      <% } %>
                </td>
                </td>
              </tr>
              <% }) %>
          </tbody>
        </table>
      </div>

      <!-- Team -->
      <div class="tab-pane fade" id="team">
        <form action="/admin/team" method="POST" enctype="multipart/form-data"
          class="bg-white p-4 rounded shadow-sm mb-4">
          <h3>Add Team Member</h3>

          <input class="form-control mb-2" name="fullName" placeholder="Full Name" required />
          <input class="form-control mb-2" name="role" placeholder="Role" required />

          <!-- Replace URL input with file upload -->
          <label class="form-label">Profile Image</label>
          <input type="file" class="form-control mb-3" name="image" accept="image/*" required />

          <button class="btn btn-primary">Add Member</button>
        </form>

        <h3>Existing Team</h3>
        <table class="table table-striped align-middle">
          <thead>
            <tr>
              <th>Name</th>
              <th>Role</th>
              <th>Image</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% teamMembers.forEach(m=> { %>
              <tr>
                <td>
                  <%= m.fullName %>
                </td>
                <td>
                  <%= m.role %>
                </td>
                <td><img src="<%= m.imageUrl %>" style="height:40px; border-radius:4px;" /></td>
                <td>
                  <!-- Edit Button -->
                  <button type="button" class="btn btn-warning btn-sm me-2"
                    onclick="editMember('<%= m.id %>', '<%= m.fullName %>', '<%= m.role %>')">
                    <i class="fas fa-edit"></i> Edit
                  </button>

                  <!-- Delete Form -->
                  <form action="/team/delete/<%= m.id %>" method="POST" class="d-inline"
                    onsubmit="return confirm('Are you sure you want to delete this team member?');">
                    <button type="submit" class="btn btn-danger btn-sm">
                      <i class="fas fa-trash-alt"></i> Delete
                    </button>
                  </form>
                </td>
              </tr>
              <% }) %>
          </tbody>
        </table>

        <!-- Hidden Edit Modal -->
        <div class="modal fade" id="editTeamModal" tabindex="-1" aria-hidden="true">
          <div class="modal-dialog">
            <form id="editTeamForm" method="POST" enctype="multipart/form-data" class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Edit Team Member</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <input type="hidden" name="id" id="editId">
                <input type="text" class="form-control mb-2" name="fullName" id="editName" placeholder="Full Name"
                  required>
                <input type="text" class="form-control mb-2" name="role" id="editRole" placeholder="Role" required>
                <label class="form-label">Change Image (optional)</label>
                <input type="file" class="form-control mb-3" name="image" accept="image/*">
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-success">Save Changes</button>
              </div>
            </form>
          </div>
        </div>
      </div>
      <!-- Publications -->
      <div class="tab-pane fade" id="publications">
        <!-- Add Publication Form -->
        <form action="/admin/publications" method="POST" class="bg-white p-4 rounded shadow-sm mb-4">
          <h3>Add Publication</h3>

          <input class="form-control mb-2" name="title" placeholder="Publication Title" required />
          <textarea class="form-control mb-2" name="description" placeholder="Description" rows="3" required></textarea>
          <select class="form-control mb-2" name="category" required>
            <option value="">Select Category</option>
            <option value="research">Research</option>
            <option value="report">Reports</option>
            <option value="article">Articles</option>
            <option value="news">News</option>
          </select>
          <input type="url" class="form-control mb-2" name="buttonLink"
            placeholder="Optional: External Link (e.g., PDF, article URL)" />
          <label class="form-label">Posted Date</label>
          <input type="date" class="form-control mb-3" name="postedDate" required />
          <button class="btn btn-primary">Add Publication</button>
        </form>

        <!-- Publications Table -->
        <h3>Existing Publications</h3>
        <table class="table table-striped align-middle">
          <thead>
            <tr>
              <th>Title</th>
              <th>Category</th>
              <th>Posted Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% publications.forEach(p=> { %>
              <tr>
                <td>
                  <%= p.title %>
                </td>
                <td>
                  <%= p.category %>
                </td>
                <td>
                  <%= new Date(p.postedDate).toLocaleDateString() %>
                </td>
                <td>
                  <button type="button" class="btn btn-warning btn-sm me-2"
                    onclick="editPublication('<%= p.id %>', '<%= p.title %>', '<%= p.description %>', '<%= p.category %>', '<%= p.buttonLink %>', '<%= p.postedDate.toISOString().split('T')[0] %>')">
                    <i class="fas fa-edit"></i> Edit
                  </button>
                  <form action="/publications/delete/<%= p.id %>" method="POST" class="d-inline"
                    onsubmit="return confirm('Are you sure you want to delete this publication?');">
                    <button type="submit" class="btn btn-danger btn-sm">
                      <i class="fas fa-trash-alt"></i> Delete
                    </button>
                  </form>


                </td>
              </tr>
              <% }) %>
          </tbody>
        </table>

        <!-- Edit Publication Modal -->
        <div class="modal fade" id="editPublicationModal" tabindex="-1" aria-hidden="true">
          <div class="modal-dialog">
            <form id="editPublicationForm" method="POST" class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Edit Publication</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <input type="hidden" name="id" id="editPubId">
                <input type="text" class="form-control mb-2" name="title" id="editPubTitle" placeholder="Title"
                  required>
                <textarea class="form-control mb-2" name="description" id="editPubDescription" rows="3"
                  placeholder="Description" required></textarea>

                <label class="form-label">Category</label>
                <select class="form-control mb-2" name="category" id="editPubCategory" required>
                  <option value="research">Research</option>
                  <option value="report">Reports</option>
                  <option value="article">Articles</option>
                  <option value="news">News</option>
                </select>

                <input type="url" class="form-control mb-2" name="buttonLink" id="editPubButtonLink"
                  placeholder="Optional: External Link" />

                <label class="form-label">Posted Date</label>
                <input type="date" class="form-control mb-3" name="postedDate" id="editPubPostedDate" required />
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-success">Save Changes</button>
              </div>
            </form>
          </div>
        </div>
      </div>
      <!-- Contact -->
      <div class="tab-pane fade" id="contact">
        Here, you can manage contact inquiries.
        <br /><br />

        <h3>Existing Contacts</h3>
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Name</th>
              <th>Phone</th>
              <th>Email</th>
              <th>Message</th>
            </tr>
          </thead>
          <tbody>
            <% contacts.forEach(c=> { %>
              <tr>
                <td>
                  <%= c.fullName %>
                </td>
                <td>
                  <%= c.phone %>
                </td>
                <td>
                  <%= c.email %>
                </td>
                <td>
                  <%= c.message %>
                </td>
              </tr>
              <% }) %>
          </tbody>
        </table>
      </div>

      <!-- Partners -->
      <div class="tab-pane fade" id="partners">
        <form action="/admin/partners" method="POST" class="bg-white p-4 rounded shadow-sm mb-4">
          <h3>Add Partner</h3>
          <input class="form-control mb-2" name="name" placeholder="Name" required />
          <input class="form-control mb-2" name="website" placeholder="Website" required />
          <input class="form-control mb-2" name="logo" placeholder="Logo URL" required />
          <button class="btn btn-primary">Add Partner</button>
        </form>

        <h3>Existing Partners</h3>
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Name</th>
              <th>Website</th>
              <th>Logo</th>
            </tr>
          </thead>
          <tbody>
            <% partners.forEach(p=> { %>
              <tr>
                <td>
                  <%= p.name %>
                </td>
                <td>
                  <%= p.website %>
                </td>
                <td><img src="<%= p.logo %>" style="height:40px" /></td>
                <td>
                  <form action="/partners/delete/<%= p.id %>" method="POST" class="d-inline"
                    onsubmit="return confirm('Are you sure you want to delete this partner?');">
                    <button type="submit" class="btn btn-danger btn-sm">
                      <i class="fas fa-trash-alt"></i> Delete
                    </button>
                  </form>
                </td>
              </tr>
              <% }) %>
          </tbody>
        </table>
      </div>
      <div class="tab-pane fade" id="membership-requests">
        <h3>Membership Requests</h3>
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Plan</th>
              <th>Message</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <% membershipRequests.forEach(m=> { %>
              <tr>
                <td>
                  <%= m.name %>
                </td>
                <td>
                  <%= m.email %>
                </td>
                <td>
                  <%= m.phone %>
                </td>
                <td>
                  <%= m.plan %>
                </td>
                <td>
                  <%= m.message %>
                </td>
                <td>
                  <form action="mailto:<%= m.email %>" method="POST" class="d-inline"
                    onsubmit="return confirm('You are about to send an email to this user. Do you want to continue?');">
                    <button type="submit" class="btn btn-primary btn-sm">
                      <i class="fas fa-envelope"></i> Send Email
                    </button>
                  </form>
                </td>
                <td></td>
              </tr>
              <% }) %>
          </tbody>
        </table>
      </div>
      <div class="tab-pane fade" id="newsletter">
        <h3>Newsletter Subscribers</h3>
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Email</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <% newsletterSubscribers.forEach(m=> { %>
              <tr>
                <td>
                  <%= m.email %>
                </td>
                <td>
                <td>
                  <form action="mailto:<%= m.email %>" method="POST" class="d-inline"
                    onsubmit="return confirm('You are about to send an email to this user. Do you want to continue?');">
                    <button type="submit" class="btn btn-primary btn-sm">
                      <i class="fas fa-envelope"></i> Send Email
                    </button>
                  </form>
                </td>
                <td></td>
              </tr>
              <% }) %>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    function editPublication(id, title, description, category, buttonLink, postedDate) {
      // Fill the form fields
      document.getElementById('editPubId').value = id;
      document.getElementById('editPubTitle').value = title;
      document.getElementById('editPubDescription').value = description;
      document.getElementById('editPubCategory').value = category;
      document.getElementById('editPubButtonLink').value = buttonLink || '';
      document.getElementById('editPubPostedDate').value = postedDate;

      // ✅ Set the action dynamically
      const form = document.getElementById('editPublicationForm');
      form.action = `/publications/edit/${id}`;

      // Show modal using Bootstrap 5 API
      const modalElement = document.getElementById('editPublicationModal');
      const modal = new bootstrap.Modal(modalElement);
      modal.show();
    }
    function editMember(id, name, role) {
      // Fill modal fields
      document.getElementById("editId").value = id;
      document.getElementById("editName").value = name;
      document.getElementById("editRole").value = role;

      // Set form action dynamically
      const form = document.getElementById("editTeamForm");
      form.action = `/team/edit/${id}`;

      // Show modal (requires Bootstrap JS)
      const editModal = new bootstrap.Modal(document.getElementById("editTeamModal"));
      editModal.show();
    }
  </script>


</body>

</html>